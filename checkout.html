<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Checkout - FramesPerSomething</title>
  <style>
    body {
      margin: 0;
      font-family: 'Arial', sans-serif;
      background-color: #111;
      color: #f2f2f2;
    }

    nav {
      background: #000;
      padding: 1rem 2rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    nav .logo {
      font-weight: bold;
      font-size: 1.2rem;
    }

    nav a {
      color: #f2f2f2;
      text-decoration: none;
    }

    nav ul {
      list-style: none;
      display: flex;
      gap: 1.5rem;
    }

    nav ul li a:hover {
      opacity: 0.6;
    }

    header {
      padding: 3rem 2rem 1rem;
      text-align: center;
    }

    h1 {
      font-size: 2rem;
    }

    h2 {
      font-size: 1.3rem;
      margin-bottom: 0.5rem;
      color: #0ff;
    }

    .container {
      padding: 2rem;
      max-width: 800px;
      margin: 0 auto;
    }

    .item {
      background: #1a1a1a;
      border: 1px solid #333;
      border-radius: 8px;
      padding: 1rem;
      margin-bottom: 1rem;
    }

    .item strong {
      display: block;
      font-size: 1.1rem;
    }

    .summary {
      margin-top: 2rem;
      font-size: 1.1rem;
    }

    select, input[type="text"] {
      width: 100%;
      padding: 0.5rem;
      margin: 1rem 0;
      background: #222;
      color: #fff;
      border: 1px solid #444;
      border-radius: 5px;
    }

    button {
      background: #0ff;
      color: #000;
      font-weight: bold;
      border: none;
      padding: 0.8rem 1.2rem;
      border-radius: 5px;
      cursor: pointer;
      margin-top: 1rem;
    }

    footer {
      text-align: center;
      font-size: 0.8rem;
      padding: 2rem;
      color: #555;
    }
  </style>
</head>
<body>
  <nav>
    <div class="logo"><a href="index.html">FramesPerSomething</a></div>
    <ul>
      <li><a href="index.html#home">Home</a></li>
      <li><a href="index.html#drops">Drops</a></li>
      <li><a href="index.html#about">About</a></li>
      <li><a href="index.html#testimonials">Stories</a></li>
      <li><a href="shop.html">Shop</a></li>
    </ul>
  </nav>

  <header>
    <h1>Checkout</h1>
    <p>Almost there â€” just confirm your details and shipping.</p>
  </header>

  <div class="container" id="checkout-container">
    <!-- Items will be inserted here -->
  </div>

  <footer>
    &copy; 2025 FramesPerSomething. All rights reserved.
  </footer>

  <script>
    function getCookie(name) {
  const value = `; ${document.cookie}`;
  const parts = value.split(`; ${name}=`);
  if (parts.length === 2) return parts.pop().split(';').shift();
}

function formatPrice(num) {
  return `$${Number(num).toFixed(2)}`;
}

const container = document.getElementById('checkout-container');

let cart = [];
const raw = getCookie('cart');
if (raw) {
  try {
    cart = JSON.parse(decodeURIComponent(raw));
  } catch (e) {
    console.error("Cart parse error:", e);
  }
}

if (cart.length === 0) {
  container.innerHTML = `<p style="text-align:center;">Your cart is empty. <a href="shop.html" style="color:#0ff;">Go back to the shop</a>.</p>`;
} else {
  let subtotal = 0;

  cart.forEach(item => {
    const itemTotal = item.quantity * Number(item.price);
    subtotal += itemTotal;

    const div = document.createElement('div');
    div.className = 'item';
    div.innerHTML = `
      <strong>${item.item}</strong>
      Size: ${item.size}<br>
      Quantity: ${item.quantity}<br>
      Price: ${formatPrice(item.price)} each<br>
      Total: ${formatPrice(itemTotal)}
    `;
    container.appendChild(div);
  });

  const summaryMap = {};
  cart.forEach(item => {
    const key = `${item.item} (${item.size})`;
    if (!summaryMap[key]) summaryMap[key] = 0;
    summaryMap[key] += item.quantity;
  });

  const summaryBox = document.createElement('div');
  summaryBox.className = 'summary';
  summaryBox.innerHTML = `<h2>Cart Summary</h2>`;
  const ul = document.createElement('ul');
  ul.style.paddingLeft = '1.2rem';
  for (const [key, qty] of Object.entries(summaryMap)) {
    const li = document.createElement('li');
    li.textContent = `${qty} x ${key}`;
    ul.appendChild(li);
  }
  summaryBox.appendChild(ul);
  container.appendChild(summaryBox);

  const shippingOptions = document.createElement('div');
  shippingOptions.className = 'summary';
  shippingOptions.innerHTML = `
    <label for="country">Country:</label>
    <select id="country">
      <option value="USA">USA</option>
      <option value="International">Other</option>
    </select>

    <label for="state">State (if USA):</label>
    <input type="text" id="state" placeholder="e.g. NY" />

    <div id="shipping-cost">Shipping: $0.00</div>
    <div id="total-cost">Total: ${formatPrice(subtotal)}</div>

    <button onclick="finalizeOrder()">Place Order</button>
  `;
  container.appendChild(shippingOptions);

  function updateTotals() {
    const country = document.getElementById('country').value;
    const state = document.getElementById('state').value.trim().toUpperCase();

    let shipping = 0;
    if (country !== 'USA') {
      shipping = 50;
    } else if (state !== 'NY') {
      shipping = 20;
    }

    document.getElementById('shipping-cost').textContent = `Shipping: ${formatPrice(shipping)}`;
    document.getElementById('total-cost').textContent = `Total: ${formatPrice(subtotal + shipping)}`;
  }

  document.getElementById('country').addEventListener('change', updateTotals);
  document.getElementById('state').addEventListener('input', updateTotals);

  function finalizeOrder() {
    alert("This is where you'd send the order to your backend or Discord webhook.");
    // Optionally clear the cart:
    // document.cookie = "cart=; path=/; max-age=0";
  }
}


      let shipping = 0;
      if (country !== 'USA') {
        shipping = 50;
      } else if (state !== 'NY') {
        shipping = 20;
      }

      const total = subtotal + shipping;

      const webhookURL = 'https://discord.com/api/webhooks/1392476358701219970/m27quQDtqZnSxMS5LAoCwgMHpXXqbNmooTfBlcPPTFjlAxwRB4zsEI6vDCCUUhmd2pow';
      const itemLines = cart.map(item =>
        `â€¢ ${item.quantity} x ${item.item} (${item.size}) @ $${item.price} = $${(item.quantity * item.price).toFixed(2)}`
      ).join('\n');

      const payload = {
        content: `ðŸ§¾ **New Order**\n\n${itemLines}\n\nðŸ“¦ Shipping: $${shipping.toFixed(2)}\nðŸ’° Total: $${total.toFixed(2)}\nðŸŒ Country: ${country}${state ? `\nðŸ™ï¸ State: ${state}` : ''}`
      };

      fetch(webhookURL, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(payload)
      }).then(() => {
        alert('Order placed!');
        document.cookie = 'cart=[]; path=/; max-age=0';
        window.location.href = 'index.html';
      }).catch(err => {
        console.error('Webhook Error:', err);
        alert('Failed to send order.');
      });
    


    updateTotals(); // Initialize shipping total
  </script>
</body>
</html>
